<!--
  base.html

  Esta es la plantilla principal de la aplicación. Define la estructura general de la página,
  incluyendo la barra de navegación superior, la barra lateral y el área de contenido.
  Otras plantillas (como panel.html) heredan de esta.
-->
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <!-- Meta tag para asegurar que la página sea responsive en dispositivos móviles -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- El título de la página puede ser personalizado por las plantillas hijas -->
    <title>{% block title %}HEM Lending - Panel{% endblock %}</title>
    
    <!-- Carga los archivos estáticos de Django -->
    {% load static %}
    
    <!-- Enlace a la hoja de estilos principal -->
    <link rel="stylesheet" href="{% static 'style/base.css' %}">
    
    <!-- Enlace a Font Awesome para los iconos -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">

    <link rel="icon" href="{% static 'img/favicon.png' %}" type="image/svg+xml">

    <!--
      ============================================
      INCORPORACIÓN DE BOOTSTRAP 5 (CSS)
      ============================================
    -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">

    <!-- Estilos para django-select2 -->
    <link href="https://cdn.jsdelivr.net/npm/select2@4.0.13/dist/css/select2.min.css" rel="stylesheet" />
    {{ form.media.css }}
</head>
<body>

    <!-- =================================== -->
    <!-- BARRA DE NAVEGACIÓN SUPERIOR (FIJA) -->
    <!-- =================================== -->
    <header class="top-navbar">
        <!-- Botón Hamburguesa para pantallas pequeñas -->
        <button class="btn btn-outline-secondary d-lg-none" type="button" data-bs-toggle="offcanvas" data-bs-target="#sidebarMenu" aria-controls="sidebarMenu">
            <i class="fa-solid fa-bars"></i>
        </button>

        <!-- Logo de la empresa a la izquierda -->
        <a class="navbar-brand" href="{% url 'panel_informativo' %}">
            <img src="{% static 'img/LogoHEM.png' %}" alt="HEM Lending Logo" class="me-2">
            <span class="navbar-brand-text">
                <strong class="navbar-brand-title">HEM Lending</strong>
                <small class="navbar-brand-subtitle">Dinero rápido, decisiones inteligentes.</small>
            </span>
        </a>
        
        <!-- Navegación de usuario a la derecha -->
        <nav class="user-nav ms-auto">
            <div class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                <i class="fa-solid fa-user-circle"></i> {{ user.username }}
              </a>
              <ul class="dropdown-menu dropdown-menu-end">
                <li><a class="dropdown-item" href="{% url 'profile' %}"><i class="fa-solid fa-user"></i> Ver Perfil</a></li>
                <li><hr class="dropdown-divider"></li>
                <li>
                  <form action="{% url 'logout' %}" method="post" class="d-flex">
                      {% csrf_token %}
                      <button type="submit" class="dropdown-item">
                          <i class="fa-solid fa-right-from-bracket"></i> Cerrar Sesión
                      </button>
                  </form>
                </li>
              </ul>
            </div>
        </nav>
    </header>

    <!-- ====================================================== -->
    <!-- BARRA LATERAL RESPONSIVA (Offcanvas de Bootstrap)    -->
    <!-- ====================================================== -->
    <aside class="offcanvas-lg offcanvas-start" tabindex="-1" id="sidebarMenu">
        <!-- Cabecera del menú Offcanvas (visible solo en móvil/tablet) -->
        <div class="offcanvas-header">
            <h5 class="offcanvas-title">Menú</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" data-bs-target="#sidebarMenu" aria-label="Close"></button>
        </div>

        <!-- Cuerpo del menú Offcanvas con la navegación -->
        <div class="offcanvas-body">
            <nav class="vertical-navbar">
                <ul class="nav flex-column">
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'panel_informativo' %}"><i class="fa-solid fa-chart-pie fa-fw me-2"></i>Panel Informativo</a>
                    </li>

                    <li class="nav-title"><i class="fa-solid fa-folder-open fa-fw me-2"></i>GESTIÓN</li>

                    <li class="nav-item nav-section-gestion">
                        <a class="nav-link collapsed" href="#" data-bs-target="#submenu-clientes" data-bs-toggle="collapse" role="button" aria-expanded="false" aria-controls="submenu-clientes">
                            <i class="fa-solid fa-users fa-fw me-2"></i>
                            <span>Clientes</span>
                            <i class="fa-solid fa-chevron-down submenu-arrow ms-auto"></i>
                        </a>
                        <div class="collapse" id="submenu-clientes">
                            <ul class="nav flex-column submenu">
                                <li class="nav-item"><a class="nav-link" href="{% url 'client_list' %}">Ver Lista de Clientes</a></li>
                                <li class="nav-item"><a class="nav-link" href="{% url 'client_add' %}">Registrar Nuevo</a></li>
                            </ul>
                        </div>
                    </li>

                    <li class="nav-item nav-section-gestion">
                        <a class="nav-link collapsed" href="#" data-bs-target="#submenu-prestamos" data-bs-toggle="collapse" role="button" aria-expanded="false" aria-controls="submenu-prestamos">
                            <i class="fa-solid fa-hand-holding-dollar fa-fw me-2"></i>
                            <span>Préstamos</span>
                            <i class="fa-solid fa-chevron-down submenu-arrow ms-auto"></i>
                        </a>
                        <div class="collapse" id="submenu-prestamos">
                            <ul class="nav flex-column submenu">
                                <li><a class="nav-link" href="{% url 'loan_application_list' %}">Solicitudes</a></li>
                                <li><a class="nav-link" href="{% url 'loan_list' %}">Préstamos Activos</a></li>
                                <li><a class="nav-link" href="{% url 'loan_add' %}">Registrar Nuevo</a></li>
                                <li><a class="nav-link" href="{% url 'paid_loan_list' %}">Préstamos Pagados</a></li>
                            </ul>
                        </div>
                    </li>

                    <li class="nav-title"><i class="fa-solid fa-sack-dollar fa-fw me-2"></i>FINANZAS</li>

                    <li class="nav-item nav-section-finanzas">
                        <a class="nav-link" href="{% url 'cobros_list' %}"><i class="fa-solid fa-file-invoice-dollar fa-fw me-2"></i>Cuotas Vencidas</a>
                    </li>

                    <li class="nav-item nav-section-finanzas">
                        <a class="nav-link" href="{% url 'financial_details' %}"><i class="fa-solid fa-money-bill-trend-up fa-fw me-2"></i>Resumen Financiero</a>
                    </li>

                    <li class="nav-title"><i class="fa-solid fa-gears fa-fw me-2"></i>CONFIGURACIÓN</li>

                    {% if user.is_staff %}
                    <li class="nav-item nav-section-config">
                        <a class="nav-link" href="{% url 'configuracion_impresion' %}"><i class="fa-solid fa-print fa-fw me-2"></i>Ajustes de Impresión</a>
                    </li>
                    {% endif %}

                    <li class="nav-item nav-section-config">
                        <a class="nav-link" href="{% url 'admin:gestion_prestamos_tipoprestamo_changelist' %}"><i class="fa-solid fa-tags fa-fw me-2"></i>Tipos de Préstamo</a>
                    </li>
                    <li class="nav-item nav-section-config">
                        <a class="nav-link" href="{% url 'admin:gestion_prestamos_tipogasto_changelist' %}"><i class="fa-solid fa-money-check-dollar fa-fw me-2"></i>Tipos de Gasto</a>
                    </li>
                    <li class="nav-item nav-section-config">
                        <a class="nav-link" href="{% url 'admin:gestion_prestamos_capital_changelist' %}"><i class="fa-solid fa-landmark fa-fw me-2"></i>Capital Inicial</a>
                    </li>
                    <li class="nav-item nav-section-config">
                        <a class="nav-link" href="{% url 'admin:auth_group_changelist' %}"><i class="fa-solid fa-users-gear fa-fw me-2"></i>Grupos de Usuarios</a>
                    </li>
                </ul>
            </nav>
        </div>
    </aside>

    <!-- ================================= -->
    <!-- ÁREA DE CONTENIDO PRINCIPAL       -->
    <!-- ================================= -->
    <main class="main-content">
        {% include 'includes/_messages.html' %}
        {% block content %}
        {% endblock %}
    </main>

    <!--
      ==============================================================
      INCORPORACIÓN DE JQUERY
      ==============================================================
    -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>

    <!--
      ==============================================================
      INCORPORACIÓN DE BOOTSTRAP 5 (JAVASCRIPT BUNDLE)
      ==============================================================
    -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>

    <!--
      ==============================================================
      INCORPORACIÓN DE SELECT2 (JAVASCRIPT)
      ==============================================================
    -->
    <script src="https://cdn.jsdelivr.net/npm/select2@4.0.13/dist/js/select2.min.js"></script>
    {{ form.media.js }}
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Inicializa Select2 (con manejo de errores)
            try {
                $('.django-select2').select2();
            } catch (e) {
                console.error("Error al inicializar Select2:", e);
            }

            // Oculta las alertas después de 5 segundos
            const alerts = document.querySelectorAll('.alert');
            alerts.forEach(function(alert) {
                setTimeout(function() {
                    try {
                        const bsAlert = new bootstrap.Alert(alert);
                        bsAlert.close();
                    } catch (e) {
                        // Ignorar si la alerta ya no existe
                    }
                }, 5000);
            });
        });
    </script>

</body>
</html>